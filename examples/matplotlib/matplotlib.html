<html>
<head>
    <title>Matplotlib Example</title>
    <meta charset="utf-8">
    <link rel="icon" type="image/x-icon" href="./favicon.png">

    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css" rel="stylesheet" type="text/css"/>
    <link href="https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css" rel="stylesheet" type="text/css"/>

    <script src="https://cdn.jsdelivr.net/npm/vega@5" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6" type="text/javascript"></script>
    <script src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js" type="text/javascript"></script>

    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.js" type="text/javascript"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js" type="text/javascript"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js" type="text/javascript"></script>

    <script src="https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css" rel="stylesheet">
    <link href="https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css" rel="stylesheet">

    <style>
        #sidebar {
            width: 350px;
        }
    </style>
    <py-env>
        - matplotlib
        - numpy
        - panel==0.13.1
        - bokeh
        - scikit-learn
    </py-env>
</head>
<body>
<div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
    <nav class="navbar navbar-expand-md navbar-dark sticky-top shadow" id="header" style="background-color: #000000;">
        <button type="button" class="navbar-toggle collapsed" id="sidebarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="app-header">
            <a class="navbar-brand app-logo" href="/">
                <img src="../logo.png" class="app-logo" alt="PyScript Logo">
            </a>
            <a class="title" href="" style="color: #f0ab3c;">Matplotlib Example</a>
        </div>
    </nav>
    <!-- Using Panel for the Interactive Widget,
        to generate matplotlib charts with different backend
     -->
     <div class="row overflow-hidden" id="content">
        <div class="sidenav" id="sidebar">
            <ul class="nav flex-column">
            </ul>
        </div>
        <div class="col mh-100 float-right" id="main">
            <div class="bk-root" id="wasm"></div>
            <div class="bk-root" id="html5"></div>
        </div>
    </div>

    <py-script>
        import panel as pn
        import matplotlib
        import matplotlib.pyplot as plt
        from matplotlib.figure import Figure
        from matplotlib import cm
        import numpy as np
        from sklearn.datasets import make_classification

        BACKENDS = {
            "WASM": matplotlib.get_backend(),
            "HTML": "module://matplotlib.backends.html5_canvas_backend"
        }

        SEED = np.random.seed(123456)
        X, y = make_classification(n_features=2, n_redundant=0, n_informative=2, n_clusters_per_class=1,
                                   n_classes=3, random_state=SEED)

        def get_plot():
            fig, ax = plt.subplots()
            ax.set_aspect('equal')
            ax.scatter(X[:, 0], X[:, 1], marker="o", c=y, s=25, edgecolor="k")
            ax.set_title(f"Matplotlib chart w/ Backend {matplotlib.get_backend()}")
            return fig

        fig_wasm = get_plot()
        pn.pane.Matplotlib(fig_wasm).servable(target="wasm");
    </py-script>

    <py-script output="html5">
        import matplotlib
        import matplotlib.pyplot as plt

        matplotlib.use(BACKENDS["HTML"], force=True)
        fig_html = get_plot()
        plt.show()
    </py-script>

</div>

</body>
</html>
